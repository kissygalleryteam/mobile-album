<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>MobileAlbum的demo</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="apple-touch-icon-precomposed" href="http://a.tbcdn.cn/mw/s/hi/tbtouch/images/touch-icon.png" />
    <script src="http://g.tbcdn.cn/kissy/k/1.4.0/seed.js"></script>

    <link rel="stylesheet" href="common.css"/>
    <link rel="stylesheet" href="demo.css"/>
</head>
<body>
<!-- <img src="http://gtms01.alicdn.com/tps/i1/T1eMcWFn4cXXaLOiv3-304-307.jpg"> -->
<img src="http://gtms01.alicdn.com/tps/i1/T1h9w1FXllXXXIwir3-304-302.jpg">
<section class="conversation-panel">
    <div id="J_MsgItemBox">
       <div class="msg-item msg-type-0 msg-owner-yours" style="opacity: 1;">
            <div class="p-info">
                <div class="time">2013-11-27 14:37:06
                </div>
            </div>
            <div class="msg-info">
                <s class="arrow"></s>
                <div class="title">第一组照片<span style="font-size: 10px;">(点击看大图)</span></div>
                <div class="desc">
                    <div class="desc-i">
                        <div class="proof-box J_ProofBox">
                            <a href="##">
                                <img data-idx="0" class="J_PinchImg" src="http://gtms01.alicdn.com/tps/i1/T1xbtdFuJeXXaVXBo_-1339-401.png_80x80.jpg" data-origin="http://gtms01.alicdn.com/tps/i1/T1xbtdFuJeXXaVXBo_-1339-401.png">
                                <span></span>
                            </a>
                            <a href="##">
                                <img data-idx="1" class="J_PinchImg" src="http://img03.taobaocdn.com/imgextra/i3/14701031833653118/T1WQ3JFnVcXXXXXXXX_!!290804701-0-tstar.jpg_80x80.jpg" data-origin="http://img03.taobaocdn.com/imgextra/i3/14701031833653118/T1WQ3JFnVcXXXXXXXX_!!290804701-0-tstar.jpg_600x600.jpg">
                                <span></span>
                            </a>
                            <a href="##">
                                <img data-idx="2" class="J_PinchImg" src="http://gtms01.alicdn.com/tps/i1/T18KRkFthjXXbP4lMn-319-2105.jpg_80x80.jpg" data-origin="http://gtms01.alicdn.com/tps/i1/T18KRkFthjXXbP4lMn-319-2105.jpg">
                                <span></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="msg-item msg-type-0 msg-owner-yours" style="opacity: 1;">
            <div class="p-info">
                <div class="time">2013-11-27 14:37:06
                </div>
            </div>
            <div class="msg-info">
                <s class="arrow"></s>
                <div class="title">第二组照片</div>
                <div class="desc">
                    <div class="desc-i">
                        <div class="proof-box J_ProofBox">
                            <a href="##">
                                <img data-idx="0" class="J_PinchImg" src="http://img02.taobaocdn.com/imgextra/i2/14701043388472450/T1BcdRXpRlXXXXXXXX_!!290804701-0-tstar.jpg_80x80.jpg" data-origin="http://img02.taobaocdn.com/imgextra/i2/14701043388472450/T1BcdRXpRlXXXXXXXX_!!290804701-0-tstar.jpg_400x400.jpg">
                                <!-- <img data-idx="0" class="J_PinchImg" src="http://gtms01.alicdn.com/tps/i1/T1xbtdFuJeXXaVXBo_-1339-401.png_80x80.jpg" data-origin="http://gtms01.alicdn.com/tps/i1/T1xbtdFuJeXXaVXBo_-1339-401.png"> -->
                                <span></span>
                            </a>
                            <a href="##">
                                <img data-idx="1" class="J_PinchImg" src="http://img03.taobaocdn.com/imgextra/i3/14701031833653118/T1WQ3JFnVcXXXXXXXX_!!290804701-0-tstar.jpg_80x80.jpg" data-origin="http://img03.taobaocdn.com/imgextra/i3/14701031833653118/T1WQ3JFnVcXXXXXXXX_!!290804701-0-tstar.jpg_600x600.jpg">
                                <span></span>
                            </a>
                            <a href="##">
                                <img data-idx="2" class="J_PinchImg" src="http://img02.taobaocdn.com/imgextra/i2/14701031606854263/T1stQLFn4cXXXXXXXX_!!290804701-0-tstar.jpg_80x80.jpg" data-origin="http://img02.taobaocdn.com/imgextra/i2/14701031606854263/T1stQLFn4cXXXXXXXX_!!290804701-0-tstar.jpg_400x400.jpg">
                                <!-- <img data-idx="2" class="J_PinchImg" src="http://gtms01.alicdn.com/tps/i1/T18KRkFthjXXbP4lMn-319-2105.jpg_80x80.jpg" data-origin="http://gtms01.alicdn.com/tps/i1/T18KRkFthjXXbP4lMn-319-2105.jpg"> -->
                                <span></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

<section id="J_PinchBoxWrap" class="f18-pinch-box" style="display: none;">
    <div id="J_PinchBox">
        
    </div>
    <div class="pinch-ctl">
        <a class="J_Back back" href="##">返回</a>
        <ul class="slide-pinch-trigger J_SlidePinchTrigger">
        </ul>
        <ul class="image-desc"></ul>
    </div>
</section>
<script>
var S = KISSY;
if (S.Config.debug) {
    var srcPath = "../../";
    S.config({
        packages:[
            {
                name:"gallery/mobile-album",
                path:srcPath,
                charset:"utf-8",
                ignorePackageNameInUri:true
            }
        ]
    });
}

KISSY.use('node, json, gallery/mobile-album/1.0/index', function(S, Node, JSON, MoAm){
    var $ = Node.all;

    var MoAm = new MoAm({
        box: $('#J_PinchBox')
        ,boxWrap: $('#J_PinchBoxWrap')
        ,minScale: 0.2
        ,maxScale: 20
    })

    var flag = false;
    $(document).delegate('touchend click', '.J_PinchImg', function(e){
        e.halt();
        if( flag == true) return ;
        flag = true;
        setTimeout(function(){flag = false;}, 1000);

        var target = $(e.currentTarget);
        if( target.prop('tagName').toUpperCase() != 'IMG'){
            target = target.one('img');
        }

        var imgEls = target.parent('.J_ProofBox').all('img');

        //ready for init album one time
        var data = [];
        imgEls.each(function(item, i){
            data.push({
                miniSrc: item.attr('src')
                ,originSrc: item.attr('data-origin')
                ,index: i
                ,size: {
                    width: item.prop('offsetWidth')
                    ,height: item.prop('offsetHeight')
                }
            })
        })

        MoAm.setIndex(parseInt(target.attr('data-idx')))
        MoAm.data(data);
        MoAm.init();
    })

    $(document).delegate('singleTap click', '.J_Back', function(e){
        MoAm.hide();
    })

    //lock document scroll
    // $(document).on('touchstart', function(e){e.halt();})
    // $(document).on('touchmove', function(e){e.halt();})
    // $(document).on('touchend', function(e){e.halt();})
})
</script>
</body>
</html>