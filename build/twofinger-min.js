/*!build time : 2014-11-28 2:09:05 PM*/
KISSY.add("kg/mobile-album/3.0.0/tools",function(){var a={getBoxOffsetIfOverflow:function(a,b,c){var d=document.documentElement.clientWidth,e=(document.documentElement.clientHeight,0),f=0;return e=a.offset.x+c.x>0?a.offset.x+c.x:b.width*a.scale+(a.offset.x+c.x)-d<0?b.width*a.scale+(a.offset.x+c.x)-d:0,f=a.offset.y+c.y,{x:e,y:f}},setCloseTo_slideline:function(a,b,c,d){var e=d.scale,f=d.offset,g=1,h={x:0,y:0},i=document.documentElement.clientWidth,j=document.documentElement.clientHeight;return 1>e?(g=1,h={x:0,y:0}):(g=e,h=f,b.width*e>i?f.x+f.x>0?h.x=0:b.width*e+f.x-i<0&&(h.x=0-(b.width*e-i)):h.x=0,b.height*e>j?f.y>0-c.top*e?h.y=0-c.top*e:b.height*e+f.y+c.top*e-j<0&&(h.y=0-(b.height*e+c.top*e-j)):h.y=0-(c.top*e-(j-b.height*e)/2)),{scale:g,offset:h}},setTransform:function(a,b,c){return a&&0!=a.length?(a.css("-webkit-transform","translate("+b.offset.x+"px,"+b.offset.y+"px) scale("+b.scale+")"),a.data("transform",b),void(1.5*c&&(a.addClass("transition_back"),setTimeout(function(){a.removeClass("transition_back")},1.5*c)))):!1},setScaleByOrigin:function(a,b,c){var d=a*b.scale,e={x:(b.scale-d)/b.scale*(c.x-b.offset.x),y:(b.scale-d)/b.scale*(c.y-b.offset.y)},f={x:b.offset.x+e.x,y:b.offset.y+e.y};return{scale:d,offset:f}},getOffsetOnTwoPoints:function(a,b){return{x:b.x-a.x,y:b.y-a.y}},getTouchPoint:function(a,b){return b||(b={left:0,top:0}),{x:a[0].pageX-b.left,y:a[0].pageY-b.top}},getTouchPoints:function(a,b){return b||(b={left:0,top:0}),Array.prototype.slice.call(a).map(function(a){return{x:a.pageX-b.left,y:a.pageY-b.top}})},getSlideAction:function(a,b,c,d){if(!a||a.length<=1)return!1;var e=document.documentElement.clientWidth,f=(document.documentElement.clientHeight,a.length),g=a[f-1].t-a[0].t;if(Math.abs(c.x)>e/2)return c.x<0?"next":"prev";if(500>g){for(var h=(a[b-1].x-a[b-2].x,0),i=0,j=0,k=0,l=0;b-1>l;++l){var m=a[l],n=a[l+1];m.x>n.x?++h:m.x<n.x&&++i,j+=Math.abs(m.t-n.t),k+=Math.abs(m.x-n.x)}if(1==d.scale||Math.abs(c.x)>e/10){var o=.3;if(k/j>o&&i==b-1)return"prev";if(k/j>o&&h==b-1)return"next"}}return""},getRectifiedCoo:function(a,b){function c(a,b,c){var d=Math.abs(b.x-a.x),e=Math.abs(b.y-a.y);return"y"==c?(b.y=a.y,"y"):"x"==c?(b.x=a.x,"x"):d>e?(b.y=a.y,"y"):(b.x=a.x,"x")}if(a.length<=1)return{point:a[a.length-1],action:b};b=b||"";for(var d=a.length,e=b,f=0;d-1>f;++f)e=c(a[f],a[f+1],e);return{point:a[d-1],action:e}}};return a},{requires:[]}),KISSY.add("kg/mobile-album/3.0.0/twofinger",function(a,b,c,d,e){function f(a){f.superclass.constructor.call(this,a)}function g(a){return{x:(a[1].x+a[0].x)/2,y:(a[1].y+a[0].y)/2}}function h(a){return Math.abs((a[1].x-a[0].x)*(a[1].x-a[0].x)+(a[1].y-a[0].y)*(a[1].y-a[0].y))}var i=(d.all,{box:{value:null},elTrigger:{value:""},elOriginSize:{value:{width:0,height:0}},maxScale:{value:3},clientWidth:{value:0},clientHeight:{value:0},elOffset:{value:{x:0,y:0}},startPoint:{value:[{x:0,y:0},{x:0,y:0}]},cacheTransform:{value:{scale:1,offset:{x:0,y:0}}},prevTransform:{value:{scale:1,offset:{x:0,y:0}}}}),j={initializer:function(){this._event()},_event:function(){var a=this.get("box"),b=this.get("elTrigger");a.delegate("gesturestart",b,this._gesturestart,this),a.delegate("touchstart",b,this._touchstart,this),a.delegate("touchmove",b,this._touchmove,this),a.delegate("touchend",b,this._toucheend,this)},_prepare:function(){var a=this.get("box"),b=this.get("elTrigger"),c=a.one(b),d=c;"IMG"!=c.prop("tagName").toUpperCase()&&(d=c.all("img")),this.set("elOriginSize",{width:d.prop("offsetWidth"),height:d.prop("offsetHeight"),offset:{x:0,y:0}}),this.set("elOffset",{left:d.prop("offsetLeft"),top:d.prop("offsetTop")}),this.set("clientWidth",document.documentElement.clientWidth),this.set("clientHeight",document.documentElement.clientHeight),this.set("cacheTransform",c.data("transform")||{scale:1,offset:{x:0,y:0}}),this.set("prevTransform",c.data("transform")||{scale:1,offset:{x:0,y:0}})},_gesturestart:function(){var a=this.get("box");elTrigger=this.get("elTrigger");var b=a.one(elTrigger);this._prepare(),a.delegate("gesturechange",elTrigger,this._gesturechange,this),a.delegate("gestureend",elTrigger,this._gestureend,this),b.removeClass("transition_back"),b.addClass("transition_pinch")},_gesturechange:function(){},_gestureend:function(){var a=this.get("box"),b=this.get("elTrigger"),c=a.one(b),d=e.setCloseTo_slideline(c,this.get("elOriginSize"),this.get("elOffset"),this.get("prevTransform"));this.set("cacheTransform",this.get("prevTransform")),this.set("prevTransform",d),this.update(300),a.undelegate("gesturechange",b,this._gesturechange,this),a.undelegate("gestureend",b,this._gestureend,this),c.removeClass("transition_pinch")},_touchstart:function(a){if(2==a.touches.length){"apple"!=c.mobile&&this._gesturestart();var b=[{x:a.touches[0].clientX,y:a.touches[0].clientY},{x:a.touches[1].clientX,y:a.touches[1].clientY}];this.set("startPoint",b)}},_touchmove:function(a){if(2==a.touches.length){var b=[{x:a.touches[0].clientX,y:a.touches[0].clientY},{x:a.touches[1].clientX,y:a.touches[1].clientY}],c=g(this.get("startPoint")),d=g(b),f={x:d.x-c.x,y:d.y-c.y},i=h(b)/h(this.get("startPoint")),j=c,f=f,k=this.get("prevTransform");k=e.setScaleByOrigin(i,k,j),k.offset={x:k.offset.x+f.x,y:k.offset.y+f.y},this.set("cacheTransform",this.get("prevTransform")),this.set("prevTransform",k),this.set("startPoint",b),this.update()}},_toucheend:function(){"apple"!=c.mobile&&this._gestureend()},update:function(a){var b=this.get("box"),c=this.get("elTrigger"),d=b.one(c),f=this.get("prevTransform");f.scale>=this.get("maxScale")&&(f=this.get("cacheTransform"),this.set("prevTransform",this.get("cacheTransform"))),e.setTransform(d,f,a,"pinch"),d.data("tranform",f)}};return a.extend(f,b,j,{ATTRS:i}),f},{requires:["base","ua","node","./tools"]});