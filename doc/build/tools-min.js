/*!build time : 2014-11-28 2:09:05 PM*/
KISSY.add("kg/mobile-album/3.0.0/tools",function(){var a={getBoxOffsetIfOverflow:function(a,b,c){var d=document.documentElement.clientWidth,e=(document.documentElement.clientHeight,0),f=0;return e=a.offset.x+c.x>0?a.offset.x+c.x:b.width*a.scale+(a.offset.x+c.x)-d<0?b.width*a.scale+(a.offset.x+c.x)-d:0,f=a.offset.y+c.y,{x:e,y:f}},setCloseTo_slideline:function(a,b,c,d){var e=d.scale,f=d.offset,g=1,h={x:0,y:0},i=document.documentElement.clientWidth,j=document.documentElement.clientHeight;return 1>e?(g=1,h={x:0,y:0}):(g=e,h=f,b.width*e>i?f.x+f.x>0?h.x=0:b.width*e+f.x-i<0&&(h.x=0-(b.width*e-i)):h.x=0,b.height*e>j?f.y>0-c.top*e?h.y=0-c.top*e:b.height*e+f.y+c.top*e-j<0&&(h.y=0-(b.height*e+c.top*e-j)):h.y=0-(c.top*e-(j-b.height*e)/2)),{scale:g,offset:h}},setTransform:function(a,b,c){return a&&0!=a.length?(a.css("-webkit-transform","translate("+b.offset.x+"px,"+b.offset.y+"px) scale("+b.scale+")"),a.data("transform",b),void(1.5*c&&(a.addClass("transition_back"),setTimeout(function(){a.removeClass("transition_back")},1.5*c)))):!1},setScaleByOrigin:function(a,b,c){var d=a*b.scale,e={x:(b.scale-d)/b.scale*(c.x-b.offset.x),y:(b.scale-d)/b.scale*(c.y-b.offset.y)},f={x:b.offset.x+e.x,y:b.offset.y+e.y};return{scale:d,offset:f}},getOffsetOnTwoPoints:function(a,b){return{x:b.x-a.x,y:b.y-a.y}},getTouchPoint:function(a,b){return b||(b={left:0,top:0}),{x:a[0].pageX-b.left,y:a[0].pageY-b.top}},getTouchPoints:function(a,b){return b||(b={left:0,top:0}),Array.prototype.slice.call(a).map(function(a){return{x:a.pageX-b.left,y:a.pageY-b.top}})},getSlideAction:function(a,b,c,d){if(!a||a.length<=1)return!1;var e=document.documentElement.clientWidth,f=(document.documentElement.clientHeight,a.length),g=a[f-1].t-a[0].t;if(Math.abs(c.x)>e/2)return c.x<0?"next":"prev";if(500>g){for(var h=(a[b-1].x-a[b-2].x,0),i=0,j=0,k=0,l=0;b-1>l;++l){var m=a[l],n=a[l+1];m.x>n.x?++h:m.x<n.x&&++i,j+=Math.abs(m.t-n.t),k+=Math.abs(m.x-n.x)}if(1==d.scale||Math.abs(c.x)>e/10){var o=.3;if(k/j>o&&i==b-1)return"prev";if(k/j>o&&h==b-1)return"next"}}return""},getRectifiedCoo:function(a,b){function c(a,b,c){var d=Math.abs(b.x-a.x),e=Math.abs(b.y-a.y);return"y"==c?(b.y=a.y,"y"):"x"==c?(b.x=a.x,"x"):d>e?(b.y=a.y,"y"):(b.x=a.x,"x")}if(a.length<=1)return{point:a[a.length-1],action:b};b=b||"";for(var d=a.length,e=b,f=0;d-1>f;++f)e=c(a[f],a[f+1],e);return{point:a[d-1],action:e}}};return a},{requires:[]});